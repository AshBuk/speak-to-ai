╔══════════════════════════════════════════════════════════════════════════╗
║                    SPEAK-TO-AI AUDIO WORKFLOW                            ║
╚══════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────┐
│  CONFIG: ~/.config/speak-to-ai/config.yaml                              │
│  audio:                                                                 │
│    recording_method: "arecord"  ← DEFAULT (can switch to "ffmpeg")      │
│    device: "default"                                                    │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│  AUDIO RECORDER FACTORY                                                 │
│  [audio/factory/factory.go]                                             │
│  ├─ CreateRecorder()                                                    │
│  └─ CreateRecorderWithFallback()  ← Tests and falls back if needed      │
└─────────────────────────────────────────────────────────────────────────┘
                      │                               │
          ┌───────────┴───────────┐                   │
          ▼                       ▼                   │
┏━━━━━━━━━━━━━━━━━━┓      ┏━━━━━━━━━━━━━━━━━━┓        │
┃ ARECORD          ┃      ┃ FFMPEG           ┃        │
┃ (ALSA Direct)    ┃      ┃ (PulseAudio)     ┃        │
┃ ✅ DEFAULT       ┃      ┃ ✅ ALSO WORKS    ┃        │
┗━━━━━━━━━━━━━━━━━━┛      ┗━━━━━━━━━━━━━━━━━━┛        │
          │                       │                   │
          └───────────┬───────────┘                   │
                      ▼                               │
         ┌────────────────────────┐                   │
         │ BaseRecorder           │◄──────────────────┘
         │ [audio/recorders/base_recorder.go] │
         │ ExecuteRecordingCommand() │
         └────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────┐
│  SYSTEM AUDIO STACK                                     │
│                                                         │
│  PATH 1: arecord                  PATH 2: ffmpeg        │
│  ═════════════════                ═══════════════       │
│                                                         │
│  arecord cmd                      ffmpeg -f pulse       │
│      ↓                                ↓                 │
│  ALSA kernel driver              PulseAudio compat      │
│      ↓                                ↓                 │
│  Hardware (ALC294)               PipeWire               │
│                                       ↓                 │
│                                  ALSA kernel            │
│                                       ↓                 │
│                                  Hardware (ALC294)      │
│                                                         │
│  Latency: LOW ✅                 Latency: MEDIUM ⚠️     │
│  Complexity: SIMPLE ✅           Complexity: HIGHER ⚠️  │
└─────────────────────────────────────────────────────────┘
                                    │
                                    ▼
         ┌───────────────────────────────────────┐
         │ TempFileManager                       │
         │ [audio/processing/tempfile_manager.go]│
         │ TempAudioPath/audio_*.wav             │
         └───────────────────────────────────────┘
                      │
                      ▼
         ┌─────────────────────────────────┐
         │ WhisperEngine                   │
         │ [whisper/engine.go]             │
         │ Speech → Text                   │
         └─────────────────────────────────┘
                      │
                      ▼
         ┌─────────────────────────────────┐
         │ OutputManager                   │
         │ [output/outputters/]            │
         │ → Clipboard OR Active Window    │
         └─────────────────────────────────┘

════════════════════════════════════════════════════════════════════════════

USE ARECORD (ALSA):
When to use:
├─  Need lowest latency (~5ms)
├─  Simple voice dictation workflow
├─  Concurrent audio: Using 'default' device on modern Linux (PipeWire/PulseAudio)
│   Example: arecord -D default → routes through PipeWire
├─  Exclusive access: Only with hardware devices (hw:X,Y)
    Example: arecord -D hw:0,0 → blocks other apps

____________________________________________________________________________
USE FFMPEG (PipeWire/PulseAudio):
When to use:
├─  Recording during video calls (Google Meet, Zoom, Discord)
├─  Multiple apps need microphone simultaneously
└─  Need robust device resolution
Capabilities:
├─  Concurrent audio: Always (via PulseAudio API)
├─  Auto-resolves 'default' → actual source name
├─  Warm-up mechanism: Prevents clipped audio starts
└─  Adaptive flush: Handles short recordings reliably
Trade-offs:
└─  Higher latency (~20-30ms), requires PipeWire/PulseAudio running
____________________________________________________________________________
CURRENT SETUP: Best of both worlds
- Default: arecord (fast, simple, concurrent on modern systems)
- Manual switch: via system tray menu or config
- Auto-fallback: switches if method fails (device busy, permission denied, etc)

════════════════════════════════════════════════════════════════════════════

