--- a/configure.ac
+++ b/configure.ac
@@ -119,12 +119,15 @@ AS_IF([test "x$enable_tests" != "xno"],[
                                   [have_tests=yes]
 )
 
+# Initialize valgrind variable
+have_valgrind=no
+
 AS_IF([test "x$enable_tests" != "xno"], [
-	PKG_CHECK_MODULES(DBUSMENUTESTSVALGRIND, valgrind, have_valgrind=yes, have_valgrind=no)
+    PKG_CHECK_MODULES(DBUSMENUTESTSVALGRIND, valgrind, have_valgrind=yes, have_valgrind=no)
 ])
 
-AM_CONDITIONAL([HAVE_VALGRIND], [test "x$have_valgrind" = "xyes"])
+# Always define the conditional after ensuring the variable is set
+AM_CONDITIONAL([HAVE_VALGRIND], [test "x$have_valgrind" = "xyes"])
 
 AC_SUBST(DBUSMENUTESTS_CFLAGS)
 AC_SUBST(DBUSMENUTESTS_LIBS) 