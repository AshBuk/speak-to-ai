{
    "app-id": "io.github.ashbuk.speak-to-ai",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "23.08",
    "sdk": "org.freedesktop.Sdk",
    "sdk-extensions": [
        "org.freedesktop.Sdk.Extension.golang"
    ],
    "command": "flatpak-wrapper.sh",
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--socket=wayland",
        "--socket=pulseaudio",
        "--device=dri",
        "--device=all",
        "--device=input",
        "--filesystem=home",
        "--filesystem=xdg-config/speak-to-ai:create",
        "--filesystem=/dev/input:ro",
        "--talk-name=org.freedesktop.Notifications",
        "--talk-name=org.kde.StatusNotifierWatcher",
        "--talk-name=org.ayatana.indicator.application",
        "--talk-name=org.ayatana.indicator.datetime",
        "--talk-name=org.ayatana.indicator.messages",
        "--talk-name=org.ayatana.indicator.power",
        "--talk-name=org.ayatana.indicator.session",
        "--talk-name=org.ayatana.indicator.sound",
        "--env=XDG_CURRENT_DESKTOP=GNOME",
        "--env=DESKTOP_SESSION=gnome"
    ],
    "modules": [
        {
            "name": "intltool",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://launchpad.net/intltool/trunk/0.51.0/+download/intltool-0.51.0.tar.gz",
                    "sha256": "67c74d94196b153b774ab9f89b2fa6c6ba79352407037c8c14d5aeb334e959cd"
                }
            ]
        },
        {
            "name": "ayatana-ido",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release",
                "-DENABLE_TESTS=OFF"
            ],
            "build-options": {
                "env": {
                    "PKG_CONFIG_PATH": "/app/lib/pkgconfig:/app/share/pkgconfig"
                }
            },
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/AyatanaIndicators/ayatana-ido/archive/refs/tags/0.10.4.tar.gz",
                    "sha256": "bd59abd5f1314e411d0d55ce3643e91cef633271f58126be529de5fb71c5ab38"
                }
            ],
            "modules": [
                {
                    "name": "vala",
                    "buildsystem": "autotools",
                    "sources": [
                        {
                            "type": "archive",
                            "url": "https://download.gnome.org/sources/vala/0.56/vala-0.56.17.tar.xz",
                            "sha256": "26100c4e4ef0049c619275f140d97cf565883d00c7543c82bcce5a426934ed6a"
                        }
                    ]
                }
            ]
        },
        {
            "name": "libayatana-indicator",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release",
                "-DENABLE_TESTS=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/AyatanaIndicators/libayatana-indicator/archive/refs/tags/0.9.4.tar.gz",
                    "sha256": "a18d3c682e29afd77db24366f8475b26bda22b0e16ff569a2ec71cd6eb4eac95"
                }
            ]
        },
        {
            "name": "libayatana-appindicator",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release",
                "-DENABLE_TESTS=OFF",
                "-DENABLE_BINDINGS_MONO=OFF",
                "-DENABLE_BINDINGS_VALA=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/AyatanaIndicators/libayatana-appindicator/archive/refs/tags/0.5.94.tar.gz",
                    "sha256": "884a6bc77994c0b58c961613ca4c4b974dc91aa0f804e70e92f38a542d0d0f90"
                }
            ]
        },
        {
            "name": "xdotool",
            "buildsystem": "simple",
            "build-commands": [
                "make PREFIX=/app",
                "make PREFIX=/app install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/jordansissel/xdotool/releases/download/v3.20211022.1/xdotool-3.20211022.1.tar.gz",
                    "sha256": "96f0facfde6d78eacad35b91b0f46fecd0b35e474c03e00e30da3fdd345f9ada"
                }
            ]
        },
        {
            "name": "speak-to-ai",
            "buildsystem": "simple",
            "build-options": {
                "env": {
                    "GOPATH": "/run/build/speak-to-ai/go",
                    "GOPROXY": "https://proxy.golang.org",
                    "GOSUMDB": "sum.golang.org",
                    "CGO_ENABLED": "1"
                },
                "append-path": "/usr/lib/sdk/golang/bin",
                "append-ld-library-path": "/usr/lib/sdk/golang/lib"
            },
            "build-commands": [
                "mkdir -p /app/bin",
                "mkdir -p /app/share/applications",
                "mkdir -p /app/share/icons/hicolor/scalable/apps",
                "mkdir -p /app/share/icons/hicolor/256x256/apps",
                "mkdir -p /app/share/metainfo",
                "mkdir -p /app/share/speak-to-ai/models",
                "mkdir -p /app/share/speak-to-ai/config",
                "cp -r sources/core/* /app/bin/",
                "chmod +x /app/bin/whisper",
                "go build -o /app/bin/speak-to-ai-daemon cmd/daemon/main.go",
                "cp config.yaml /app/share/speak-to-ai/config/",
                "cp flatpak-wrapper.sh /app/bin/",
                "chmod +x /app/bin/flatpak-wrapper.sh",
                "cp io.github.ashbuk.speak-to-ai.desktop /app/share/applications/",
                "cp icons/io.github.ashbuk.speak-to-ai.svg /app/share/icons/hicolor/scalable/apps/",
                "cp icons/io.github.ashbuk.speak-to-ai.png /app/share/icons/hicolor/256x256/apps/",
                "cp io.github.ashbuk.speak-to-ai.appdata.xml /app/share/metainfo/"
            ],
            "sources": [
                {
                    "type": "dir",
                    "path": "."
                }
            ]
        }
    ]
} 