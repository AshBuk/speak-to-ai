# Copyright (c) 2025 Asher Buk
# SPDX-License-Identifier: MIT

name: Lint Arch

on:
  push:
    branches: [master, main]
    paths:
      - 'packaging/arch/**'
  pull_request:
    paths:
      - 'packaging/arch/**'

jobs:
  namcap:
    runs-on: ubuntu-latest
    container:
      image: archlinux:latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install namcap
        run: pacman -Syu --noconfirm namcap pacman-contrib

      - name: Lint PKGBUILD
        run: namcap packaging/arch/PKGBUILD

      - name: Validate .SRCINFO generation
        run: |
          useradd -m builder
          cp -r packaging/arch /home/builder/
          chown -R builder:builder /home/builder/arch
          su builder -c 'cd /home/builder/arch && makepkg --printsrcinfo > .SRCINFO'
          echo "SRCINFO generated successfully"
